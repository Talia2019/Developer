# 📚 IPC (Inter Process Communication, 프로세스간 통신)

<br>

<br>

## 1. IPC (Inter Process Communication, 프로세스간 통신)

> 프로세스들 간 의사소통 하는 것을 IPC라 함

프로세스가 통신 가능하다는 것은 서로 다른 프로세스가 데이터를 주고 받을 수 있다는 것이며, 프로세스들 간 공유하는 메모리가 필요함

커널 영역에서 IPC라는 내부 프로세스간 통신(Inter Process Communication)을 제공하고, 프로세스는 커널이 제공하는 IPC 설비를 이용해 프로세스간 통신을 함

<br>

#### 스레드간 통신보다 프로세스간 통신이 어려운 이유

> 프로세스는 생성되며 별도의 자원을 할당받지만, 스레드는 메모리 공간과 자원을 공유하기 때문
>
> 프로세스간 통신을 위한 별도 공간을 만들어 줘야 하기에 더 어려움

<br>

## 2. IPC 종류

| IPC 종류      | 사용 시기                   | 공유 매개체 | 통신 단위 | 통신 방향 | 통신 가능 범위   |
| ------------- | --------------------------- | ----------- | --------- | --------- | ---------------- |
| PIPE          | 부모 자식간 단방향 통신     | 파일        | Stream    | 단방향    | 동일 시스템      |
| Named PIPE    | 다른 프로세스와 단방향 통신 | 파일        | Stream    | 단방향    | 동일 시스템      |
| Message Queue | 다른 프로세스와 단방향 통신 | 메모리      | 구조체    | 단방향    | 동일 시스템      |
| Shared Memory | 다른 프로세스와 양방향 통신 | 메모리      | 구조체    | 양방향    | 동일 시스템      |
| Memory Map    | 다른 프로세스와 양방향 통신 | 파일+메모리 | 페이지    | 양방향    | 동일 시스템      |
| Socket        | 다른 시스템간 양방향 통신   | 소켓        | Stream    | 양방향    | 동일+외부 시스템 |

<br>

### 1) PIPE

> 통신을 위한 메모리공간(버퍼)을 생성하여 프로세스가 데이터를 주고 받게끔 함

- Anonymouse PIPE, 익명 파이프

일반적인 파이프

통신할 프로세스가 명확하게 알 수 있는 경우 사용 (부모-자식 또는 형제 프로세스간 통신에 사용되고 외부 프로세스에서 사용 불가)

두개의 프로세스를 연결하고 하나의 프로세스는 `데이터를 쓰기`만, 다른 하나는 `데이터를 읽기`만 할 수 있음 (한쪽방향으로만 통신 = 반이중(Half-Duplex) 통신)

간단하게 사용 가능

단점 : 송/수신을 원한다면 두개의 파이프를 만들어야 함

- Named PIPE, 네임드 파이프

전혀 모르는 상태의 프로세스들 사이의 통신에 사용 (프로세스 통신을 위해 이름이 있는 파일을 사용하기 때문에 가능)

FIFO라 불리는 특수 파일을 이용해 관련 없는 프로세스 간 통신에 사용

즉, 외부 프로세스와 통신 가능

단점 : 전이중 통신을 위해선 익명 파이프처럼 2개를 만들어야 함

<br>

### 2) Message Queue

입출력 방식은 Named PIPE와 동일

PIPE처럼 데이터의 흐름이 아니라 메모리 공간(메모리를 사용한 PIPE) 라는 점과, PIPE나 FIFO와 달리 다수의 프로세스간 메세지를 전달할 수 있다는 차이를 가짐

사용할 데이터에 번호를 붙이며 여러 프로세스가 동시에 데이터를 쉽게 다룰 수 있음

메세지 접근을 위해서는 key가 필요

<br>

### 3) Shared Memory

> 공유 메모리가 데이터 자체를 공유하도록 지원하는 설비
>
> 프로세스간 메모리 영역을 공유해서 사용할 수 있도록 허용

프로세스가 공유 메모리 할당을 요청하면 커널은 해당 프로세스에 메모리 공간을 할당 (각 프로세스가 메모리 영역에 첨부됨)

프로세스간 Read, Write를 모두 필요로 할 때 사용

대량의 정보를 다수의 프로세스에 배포 가능

중개자 없이 바로 메모리에 접근할 수 있기에 `IPC중 가장 빠르게 작동`

<br>

### 4) Memory Map

> 열린 파일을 메모리에 맵핑시켜서 공유 (공유 매개체 = 파일 + 메모리)

공유 메모리처럼 메모리를 공유

주로 대용량 데이터를 공유해야 할 때 사용

FILE IO가 느릴대 사용하면 좋음

대부분 OS에서는 프로세스를 실행할 때 실행 파일의 각 세그먼트를 메모리에 사상하기 위해 메모리 맵 파일 이용

메모리 맵 파일은 파일의 크기를 바꿀 수 없으며, 메모리 맵 파일 사용 이전/이후에만 파일의 크기를 바꿀 수 있음

<br>

### 5) Socket

~~Unix 도메인 소켓 또는 IPC 소켓은 동일 호스트 OS에서 실행되는 프로세스간 데이터를 교환하기 위한 데이터 통신 엔드 포인트~~

네트워크 소켓통신을 통해 다른 PC간 데이터를 공유

각 PC에서 임의의 포트를 정하고 해당 포트간 데이터를 주고 받음 (1대1로 데이터 주고받는 형식)

클라이언트와 서버가 소켓을 통해 통신하는 구조로, 원격에서 프로세스간 데이터를 공유할 때 사용

전이중(Full Duplex, 양방향) 통신이 가능

서버/클라이언트 환경을 구축하는데 용이

중대형 애플리케이션에서 주로 사용

<br>

### 6) RPC (Remote Procedure Call)

분산 네트워크 망에서 많이 사용되는 방식

별도의 원격제어를 위한 코딩 없이 다른 주소 공간에서 함수나 프로시저를 실행할 수 있게 하는 프로세스간 통신 기술

즉, 원격 프로시저 호출을 이용하면 프로그래머는 함수가 실행 프로그램 로컬 위치에 있든 원격 위치에 있든 동일한 코드 이용 가능

분리된 PC에 저장된 데이터를 마치 내 PC에 존재하는 것처럼 데이터를 가져와 사용(스텁을 통해 마치 자신의 디스크에 존재하는것처럼 착각)

스텁 : 리눅스에서 공유 라이브러리의 일부 중 하나

프로시저 : 루틴, 서브루틴, 함수와 같은 뜻으로 사용되며, 하나의 프로시저는 특정 작업을 수행하기 위한 프로그램의 일부 혹은 일련의 작업 순서

<br>

## 3. Mutex & Semaphore

공유 자원을 안전하게 관리하기 위해서는 상호배제(Mutual exclusion)를 달성하기 위한 기법이 필요

뮤텍스와 세마포어는 이를 위해 고안된 기법으로, 서로 다른 방식으로 상호배제를 달성

<br>

### Mutex

Key에 해당하는 어떤 오브젝트가 있으며, 이 오브젝트를 소유한 쓰레드/프로세스만이 공유자원에 접근할 수 있음

### Semaphore

공통으로 관리하는 하나의 값을 이용해 상호배제를 달성

공유자원에 접근할 수 있는 쓰레드, 프로세스의 수를 나타내는 값을 둠

<br>

위 두 기법을 쓰더라도 데이터 무결성을 보장할 순 없으며 데드락 발생 가능. 상호배제의 기본적인 기법.
