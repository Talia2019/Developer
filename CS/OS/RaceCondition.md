# 📚 Race Condition

<br>

<br>

## 1. Race Condition (경쟁 상태)

공유 자원에 대해 여러 프로세스가 동시에 접근할 때, 접근 순서에 따라 실행 결과가 달라지는 상황

동시 접근 시 자료의 일관성을 해치는 결과가 나타남

## 2. Race Condition 발생 환경/경우

1. 멀티 프로세스 / 스레드 환경

2. 커널 작업

3. 프로세스의 System call

<br>

## 3. 멀티 프로세스 / 스레드 환경

<br>

#### 문제점

> 멀티 프로세서 환경에서 2개의 CPU가 동시에 커널 내부의 공유 데이터에 접근하여 조작하는 경우 혹은 멀티 스레드 환경에서 공통 자원을 병행하여 작업할 때

이 경우 세가지 제어 문제에 직면. `Mutual exclusion`, `Deadlock`, `Starvation`

1. Mutual exclution

Race condition을 막기 위해서는 두 개 이상의 프로세스가 공용 데이터에 동시에 접근을 하는 것을 막아야 함

즉, 한 프로세스가 공용 데이터를 사용하고 있으면 그 자원을 사용하지 못하도록 막거나, 다른 프로세스가 그 자원을 사용하지 못하도록 막으면 이 문제를 피할 수 있음

이것을 상호 배제(mutual exclusion)라고 함

2. Deadlock

그러나 위와 같은 상호 배제를 시행하면 추가적인 제어 문제가 발생 : DeadLock

3. Starvation

프로세스들이 더 이상 진행을 하지 못하고 영구적으로 블록되어 있는 상태로, 시스템 자원에 대한 경쟁 도중에 발생할 수 있고 프로세스 간의 통신 과정에도 발생할 수 있는 문제

두 개 이상의 작업이 서로 상대방의 작업이 끝나기만을 기다리고 있기 때문에 결과적으로는 아무것도 완료되지 못하는 상태

<br>

#### 해결법

> 커널 내부의 각 공유 데이터에 접근 할 때마다 그 데이터에 대한 lock/unlock을 하는 방법

Semaphore / Mutex로 해결

<br>

## 4. 커널 작업

커널 작업을 수행하는 도중에 인터럽트 발생

#### 문제점

> 커널모드에서 데이터를 로드하여 작업을 수행하다가 인터럽트가 발생하여 같은 데이터를 조작하는 경우

#### 해결법

> 커널모드에서 작업을 수행하는 동안, 인터럽트를 disable 시켜 CPU 제어권을 가져가지 못하도록 함

<br>

## 5. 프로세스의 System call

프로세스가 System call을 하여 커널 모드로 진입하여 작업 도중, Syntax 변경이 이루어질 때

#### 문제점

> 프로세스1이 커널모드에서 데이터를 조작하는 도중, 시간이 초과되어 CPU 제어권이 프로세스2로 넘어가 같은 데이터를 조작하는 경우 ( 프로세스2가 작업에 반영되지 않음 )

#### 해결법

> 프로세스가 커널모드에서 작업을 하는 경우 시간이 초과되어도 CPU 제어권이 다른 프로세스에게 넘어가지 않도록 함

<br>
